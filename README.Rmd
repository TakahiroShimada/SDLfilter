---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE)
```


SDLfilter
=========
[![DOI](https://zenodo.org/badge/27752990.svg)](https://zenodo.org/badge/latestdoi/27752990)
[![CRAN\_Status\_Badge](https://www.r-pkg.org/badges/version/SDLfilter)](https://cran.r-project.org/package=SDLfilter)

Overview 
--------
SDLfilter contains a variety of functions to screen GPS and/or Argos locations and to assess sample sizes of tracking data for the analysis of animal distributions. 


Installation
--------

```{r}
# The official version from CRAN:
install.packages("SDLfilter")

# Or the development version from GitHub:
install.packages("devtools")
devtools::install_github("TakahiroShimada/SDLfilter")
```

Usage
--------
```{r, message=FALSE}
library(SDLfilter)
```


### Location filtering

There are three main filtering functions.

1. *dupfilter* filters temporal and spatial duplicates.

2. *ddfilter* filters locations with high error.

3. *depthfilter* filters locations by water depth.

```{r SDLfilter, message=FALSE}
## Fastloc GPS data obtained from a green turtle
data(turtle)

## Remove temporal and spatial duplicates
turtle.dup <- dupfilter(turtle)

## Remove biologically unrealistic fixes 
turtle.dd <- ddfilter(turtle.dup, vmax=9.9, qi=4, ia=90, vmaxlp=2.0)
```

```{r message=FALSE, out.width = "80%", eval = TRUE, echo=FALSE}
knitr::include_graphics('man/figures/README-example1.png') 
```

```{r, message=FALSE, echo=FALSE}
 # Entire area
 p1<-map_track(turtle.dup, bgmap=Australia, point.size = 2, line.size = 0.5, axes.lab.size = 0, 
             sb.distance=200, multiplot = FALSE, point.bg = "red",
             title.size=15, title="Entire area")[[1]] + 
   geom_point(aes(x=lon, y=lat), data=turtle.dd, size=2, fill="yellow", shape=21)+
   geom_point(aes(x=x, y=y), data=data.frame(x=c(154, 154), y=c(-22, -22.5)), 
              size=3, fill=c("yellow", "red"), shape=21) + 
   annotate("text", x=c(154.3, 154.3), y=c(-22, -22.5), label=c("Retained", "Removed"), 
            colour="black", size=4, hjust = 0)

 # Zoomed in
 p2<-map_track(turtle.dup, bgmap=SandyStrait, xlim=c(152.7, 153.2), ylim=(c(-25.75, -25.24)), 
             axes.lab.size = 0, sb.distance=10, point.size = 2, point.bg = "red", line.size = 0.5, 
             multiplot = FALSE, title.size=15, title="Zoomed in")[[1]] + 
 geom_path(aes(x=lon, y=lat), data=turtle.dd, size=0.5, colour="black", linetype=1) + 
 geom_point(aes(x=lon, y=lat), data=turtle.dd, size=2, colour="black", shape=21, fill="yellow")

 gridExtra::marrangeGrob(list(p1, p2), nrow=1, ncol=2, top =  NA)
```



### Assessing sample sizes

#### Probability-based approach

```{r message = FALSE, results=FALSE}
## 1. Utilisation uistributions of flatback turtles.
data(curtis)
```
The input data can be either a matrix or a list of RasterLayer objects. Each row of the matrix or each RasterLayer object contains the probability distribution of an animal. The function assumes that each column of a matrix is associated with a unique geographical location, therefore it is critical that the grid size and geographical extent are the consistent across UDs. In this example, the grid size was 1km and the geographical extent was 1901789, 1972789, -2750915, -2653915 (EPSG:3577) across all 29 layers.

```{r message = FALSE, results=FALSE}
## 2. Calculate overlap probability from 1000 random permutation.
overlap <- boot_overlap(curtis, R = 1000, method = "PHR")
```
It will take some time to run this code depending on the number of iterations and the machine specs. The runtime was about 2.5 minutes for 1000 iterations on a linux machine (Intel i7-8650U CPU @ 1.90GHz, 32GB RAM).

```{r}
## 3. Find the minimum sample size required to estimate the general distribution.
a <- asymptote(overlap)
```
As described in the main text, an asymptote was considered once the mean overlap probability exceeded 95% of the estimated horizontal asymptote. The sample size linked to this value was deemed to be the minimum sample size required to represent the general distribution of the group.

```{r}
## 4. Plot the mean probability and rational function fit relative to the sample sizes.
```

```{r warning = FALSE, echo = FALSE}
ggplot(data = overlap$summary)+
  geom_point(aes(x = N, y = mu), alpha = 0.5) + 
  geom_path(data = a$results, aes(x = x, y = ys)) + 
  geom_vline(xintercept = a$min.n, linetype = 2) +
  labs(x = "N", y = "Overlap probability")
```

```{r message=FALSE, out.width = "50%", eval = TRUE, echo=FALSE}
knitr::include_graphics('man/figures/README-example2.png') 
```

> Please see the package help pages and Shimada et al. (2012, 2016) for more details.


References
--------

If you use the function *ddfilter*, please cite

Shimada T, Jones R, Limpus C, Hamann M (2012) Improving data retention and home range estimates by data-driven screening. *Mar Ecol Prog Ser* 457:171-180 doi: [10.3354/meps09747](http://dx.doi.org/10.3354/meps09747)

If you use the functions *dupfilter* or *depthfilter*, please cite

Shimada T, Limpus C, Jones R, Hazel J, Groom R, Hamann M (2016) Sea turtles return home after intentional displacement from coastal foraging areas. *Mar Biol* 163:1-14 doi: [10.1007/s00227-015-2771-0](http://dx.doi.org/10.1007/s00227-015-2771-0)


Shimada T,.... (under review) Assessing sample sizes for the analysis of animal distributions using the R package SDLfilter. 


Current version
--------
2.0.0 (4 May 2020)


